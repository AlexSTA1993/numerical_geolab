
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>6. Cosserat THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion &#8212; Numerical Geolab .1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Simple shear of a 1D Cosserat layer with Breakage Mechanics material" href="Tutorial_Cosserat_Breakage_Mechanics.html" />
    <link rel="prev" title="5.8. Cauchy THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion" href="Tutorial%20Cauchy_THM_thermo_hydro_plasticity%20-%20Drucker-Prager%20yield%20criterion.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Tutorial_Cosserat_Breakage_Mechanics.html" title="7. Simple shear of a 1D Cosserat layer with Breakage Mechanics material"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Tutorial%20Cauchy_THM_thermo_hydro_plasticity%20-%20Drucker-Prager%20yield%20criterion.html" title="5.8. Cauchy THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Numerical Geolab .1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6. </span>Cosserat THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="cosserat-thm-couplings-thermo-hydro-plasticity-application-drucker-prager-yield-criterion">
<h1><span class="section-number">6. </span>Cosserat THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion<a class="headerlink" href="#cosserat-thm-couplings-thermo-hydro-plasticity-application-drucker-prager-yield-criterion" title="Permalink to this heading">¶</a></h1>
<p>In this tutorial we will validate the complex behavior of a first order micromorphic Cosserat model when yielding occurs in the presence of THM couplings,
for the case of the Drucker-Prager yield criterion.
Our model is a !D layer, that consists of one element.
The base of the layer is fixed and its top is prescribed to move lateraly along the horizontal dimension (shearing displacement).
The boundaries of the layer are considered to be insulated from its surroundings meaning that no flow of heat
and pore fluid is allowed to take place (adiabatic undrained boundary conditions). Furthermore, all lateral displacements are constrained to zero.
Under this configuration, when yielding takes place in our model
the heat that will be produced due to dissipation will lead to an increase in the temperature of the cube and
a subsequent increase of pore fluid pressure (thermal pressurization). We will study this phenomenon under a
specific choice of material parameters so that we can validate the effect of each coupling in the behavior of the Cosserat layer.</p>
<p>The file for this tutorial can be found in:
<a class="reference internal" href="ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.html#module-ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.CAUCHY_THM_ThermoHydroplasticity_0" title="ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.CAUCHY_THM_ThermoHydroplasticity_0"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.CAUCHY_THM_ThermoHydroplasticity_0</span></code></a></p>
<section id="begining-of-file">
<h2><span class="section-number">6.1. </span>Begining of file<a class="headerlink" href="#begining-of-file" title="Permalink to this heading">¶</a></h2>
<p>The file begins as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">from</span> <span class="nn">dolfin</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class="kn">from</span> <span class="nn">ngeoFE.feproblem</span> <span class="kn">import</span> <span class="n">UserFEproblem</span><span class="p">,</span> <span class="n">General_FEproblem_properties</span>
<span class="kn">from</span> <span class="nn">ngeoFE.fedefinitions</span> <span class="kn">import</span> <span class="n">FEformulation</span>
<span class="hll"><span class="kn">from</span> <span class="nn">ngeoFE.materials</span> <span class="kn">import</span> <span class="n">UserMaterial</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">ngeoFE_unittests</span> <span class="kn">import</span> <span class="n">ngeo_parameters</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">ngeoFE_unittests</span> <span class="kn">import</span> <span class="n">plotting_params</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">os</span> <span class="c1"># allows for easier handling of paths</span>
</span><span class="kn">from</span> <span class="nn">_operator</span> <span class="kn">import</span> <span class="n">itemgetter</span> <span class="c1"># allows for transformation of lists to iterables, usefull for the definition of boundary conditions</span>
</pre></div>
</div>
</section>
<section id="finite-element-formulation">
<h2><span class="section-number">6.2. </span>Finite element formulation<a class="headerlink" href="#finite-element-formulation" title="Permalink to this heading">¶</a></h2>
<p>For the implementation of the problem at hand the extra unknowns of the pressure and temperature fields need to be taken into account.
We also need to include the values of pressure and temperature inside the material description so that the correct total and effective stresses are
taken into account. Moreover, the existence of the coupled momentum, energy and mass balance partial differential equations
(see <a class="reference internal" href="Tutorial_Cauchy_THM_couplings_theory.html#tutorial-cauchy-thm-theory"><span class="std std-ref">previous tutorial</span></a>), implies that the variational form of the problem needs to be modified in
order to include the transient and coupling terms in the solution of the finite element problem. This procedure has been described in greater detail in
the <a class="reference internal" href="Tutorial_Cauchy_THM_couplings_implementation.html#tutorial-cauchy-thm-implementation"><span class="std std-ref">THM couplings implementation tutorial</span></a>. The new Finite Element formulation is given as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CosseratTHM1DFEformulation</span><span class="p">(</span><span class="n">FEformulation</span><span class="p">):</span>
     <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">     Defines a user FE formulation</span>
<span class="sd">     &#39;&#39;&#39;</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="c1"># Number of stress/deformation components</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">p_nstr</span><span class="o">=</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span>
         <span class="c1"># Number of Gauss points</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">ns</span><span class="o">=</span><span class="mi">1</span>
         <span class="c1"># Number of auxiliary quantities at gauss points</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">p_aux</span><span class="o">=</span><span class="mi">3</span>

    <span class="k">def</span> <span class="nf">auxiliary_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set user&#39;s generalized deformation vector</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">auxgde</span><span class="o">=</span><span class="p">[</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">as_vector</span><span class="p">(</span><span class="n">auxgde</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setVarFormAdditionalTerms_Res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">Du</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">svars</span><span class="p">,</span><span class="n">metadata</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
        <span class="n">Res</span><span class="o">=</span><span class="mf">0.</span>
        <span class="n">lstar</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">103</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bstar</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">104</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rhoC</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">105</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#HM terms</span>
        <span class="n">eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generalized_epsilon</span><span class="p">(</span><span class="n">Du</span><span class="p">)</span>
        <span class="n">eps_v</span><span class="o">=</span><span class="n">eps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">virtual_pf</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">Res</span><span class="o">+=-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">bstar</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">eps_v</span><span class="p">,</span><span class="n">virtual_pf</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1">#TM terms</span>
        <span class="n">virtual_Temp</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">):</span>
            <span class="n">Res</span><span class="o">+=</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">rhoC</span><span class="p">)</span><span class="o">*</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">76</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">virtual_Temp</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="c1">#HT terms</span>
        <span class="n">DTemp</span><span class="o">=</span><span class="n">Du</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">Res</span><span class="o">+=</span> <span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lstar</span><span class="o">/</span><span class="n">bstar</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">DTemp</span><span class="p">,</span><span class="n">virtual_pf</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Res</span>

    <span class="k">def</span> <span class="nf">setVarFormAdditionalTerms_Jac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">Du</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">svars</span><span class="p">,</span><span class="n">metadata</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">ddsdde</span><span class="p">):</span>
        <span class="n">Jac</span><span class="o">=</span><span class="mf">0.</span>
        <span class="n">lstar</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">101</span><span class="o">+</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bstar</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">102</span><span class="o">+</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rhoC</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">103</span><span class="o">+</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alfa</span><span class="o">=</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">104</span><span class="o">+</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#HM terms</span>
        <span class="n">eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generalized_epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="c1">#needs u (trial function, because it takes derivatives in terms of u and not Du for calculating the Jacobian.</span>
        <span class="n">eps_vol</span><span class="o">=</span><span class="n">eps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">virtual_pf</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">Jac</span><span class="o">+=+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">bstar</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">eps_vol</span><span class="p">,</span><span class="n">virtual_pf</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1">#MH terms</span>
        <span class="n">pf</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1">#same as before</span>
        <span class="n">virtual_eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generalized_epsilon</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">virtual_eps_vol</span><span class="o">=</span><span class="n">virtual_eps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Jac</span><span class="o">+=-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">pf</span><span class="p">,</span><span class="n">virtual_eps_vol</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1">#HT terms</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">Jac</span><span class="o">+=-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">lstar</span><span class="o">/</span><span class="n">bstar</span><span class="p">)</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">virtual_pf</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1">#TH terms Alexandros</span>
        <span class="n">avector</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_nstr</span><span class="p">)</span>
        <span class="n">avector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">1.</span><span class="p">;</span>
        <span class="n">eps_temp</span><span class="o">=</span><span class="n">alfa</span><span class="o">*</span><span class="n">temperature</span><span class="o">*</span><span class="n">as_vector</span><span class="p">(</span><span class="n">avector</span><span class="p">)</span>
        <span class="n">eps_temp_vol</span><span class="o">=</span><span class="n">eps_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#+eps_temp[1]+eps_temp[2]</span>
        <span class="c1">#MT terms</span>
        <span class="n">Jac</span><span class="o">+=-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">inner</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">ddsdde</span><span class="p">,</span><span class="n">eps_temp</span><span class="p">),</span><span class="n">virtual_eps</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span> <span class="c1">#changed sign</span>

        <span class="c1">#TM terms due to thermal expansion and plastic deformation</span>
        <span class="n">virtual_temp</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="c1">#change in Jacobian terms</span>

        <span class="n">eps_eff</span><span class="o">=</span><span class="n">eps</span><span class="o">+</span><span class="n">eps_temp</span>
        <span class="n">deps_plastic</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p_nstr</span><span class="p">):</span>
            <span class="n">deps_plastic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">svars</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">77</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">))</span>

        <span class="n">deps_plastic</span><span class="o">=</span><span class="n">as_vector</span><span class="p">(</span><span class="n">deps_plastic</span><span class="p">)</span>
        <span class="n">Jac</span><span class="o">+=-</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">rhoC</span><span class="p">)</span><span class="o">*</span><span class="n">inner</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">ddsdde</span><span class="p">,</span><span class="n">eps_eff</span><span class="p">),</span><span class="n">deps_plastic</span><span class="p">)</span><span class="o">*</span><span class="n">virtual_temp</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="c1">#TM terms due to fluid pressure and plastic deforamtion, i.e. thermal pressurization</span>
        <span class="n">deps_plastic_vol</span><span class="o">=</span><span class="n">deps_plastic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Jac</span><span class="o">+=+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">rhoC</span><span class="p">)</span><span class="o">*</span><span class="n">pf</span><span class="o">*</span><span class="n">deps_plastic_vol</span><span class="o">*</span><span class="n">virtual_temp</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1">#TM extra</span>
        <span class="n">Jac</span><span class="o">+=</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">rhoC</span><span class="p">)</span><span class="o">*</span><span class="n">inner</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">ddsdde</span><span class="p">,</span><span class="n">eps_temp</span><span class="p">),</span><span class="n">deps_plastic</span><span class="p">)</span><span class="o">*</span><span class="n">virtual_temp</span><span class="o">*</span><span class="n">dx</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Jac</span>

    <span class="k">def</span> <span class="nf">create_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cell</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set desired element</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">element1</span><span class="o">=</span><span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span><span class="n">cell</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">element2</span><span class="o">=</span><span class="n">FiniteElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span><span class="n">cell</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
        <span class="n">element3</span><span class="o">=</span><span class="n">VectorElement</span><span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span><span class="n">cell</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">element</span><span class="o">=</span><span class="n">MixedElement</span><span class="p">([</span><span class="n">element1</span><span class="p">,</span><span class="n">element2</span><span class="p">,</span><span class="n">element3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">element</span>

    <span class="k">def</span> <span class="nf">dotv_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set left hand side derivative coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#         return as_vector([0.,0.,0.,1000.,1000.])</span>
        <span class="n">scale_p</span><span class="o">=</span><span class="mf">1.</span>
        <span class="n">scale_t</span><span class="o">=</span><span class="mf">1.</span>
<span class="c1">#         scale=1./1000.</span>
        <span class="k">return</span> <span class="n">as_vector</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="o">*</span><span class="n">scale_p</span><span class="p">,</span><span class="mf">1.</span><span class="o">*</span><span class="n">scale_t</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="finite-element-problem-description">
<h2><span class="section-number">6.3. </span>Finite element problem description<a class="headerlink" href="#finite-element-problem-description" title="Permalink to this heading">¶</a></h2>
<p>We proceed now with building the main Finite element model, corresponding to Triaxial test of a Cauchy elastoplastic cube with a Drucker-Prager yield criterion.
The finite element model is built inside a child class that inherits its methods from the parentclass <a class="reference internal" href="ngeoFE.html#ngeoFE.feproblem.UserFEproblem" title="ngeoFE.feproblem.UserFEproblem"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UserFEproblem()</span></code></a>. We will provide here commentary for each method used inside
the childclass <a class="reference internal" href="ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.html#ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.CAUCHY_DP_THM_ThermoHydroplasticity_1.THM3D_FEproblem" title="ngeoFE_unittests.Multiphysics.Cauchy_tests.ThreeD.BVP.CAUCHY_DP_THM_ThermoHydroplasticity_1.THM3D_FEproblem"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CosseratTHM1DFEproblem(UserFEproblem)</span></code></a>.</p>
<div class="highlight-python notranslate" id="thm1d-feproblem"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CosseratTHM1DFEproblem</span><span class="p">(</span><span class="n">UserFEproblem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a user FE problem for given FE formulation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">FEformulation</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Example of 2D plane strain problem, Cosserat continuum with Drucker Prager material&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">=</span><span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem_step</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pressure_loading</span> <span class="o">=</span> <span class="mf">200.</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_eff</span> <span class="o">=</span> <span class="o">-</span><span class="mf">600.</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Pressure_loading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_total</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_eff</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Pressure_loading</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">FEformulation</span><span class="p">)</span>
</pre></div>
</div>
<p>In the class <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> method, the finite element formulation defined above is provided as argument.
We set here the length of the layer <code class="xref py py-const docutils literal notranslate"><span class="pre">w`=1</span> <span class="pre">and</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">elements</span> <span class="pre">for</span> <span class="pre">the</span> <span class="pre">analysis</span> <span class="pre">:param:`self.nw`=1</span> <span class="pre">and</span> <span class="pre">we</span> <span class="pre">introduce</span> <span class="pre">the</span> <span class="pre">variables</span> <span class="pre">that</span> <span class="pre">take</span> <span class="pre">into</span> <span class="pre">account</span> <span class="pre">the</span> <span class="pre">pore</span> <span class="pre">fulid</span> <span class="pre">pressire</span> <span class="pre">pressure</span> <span class="pre">:param:`Pressure_loading</span></code> and
the effective normal stress <code class="xref py py-const docutils literal notranslate"><span class="pre">Normal_loading_eff</span></code>. They are connected to each other through the Terzaghi relation <code class="xref py py-const docutils literal notranslate"><span class="pre">Normal_loading_total</span></code>
The initialization then proceeds to set up all the methods of the parentclass <a class="reference internal" href="ngeoFE.html#ngeoFE.feproblem.UserFEproblem" title="ngeoFE.feproblem.UserFEproblem"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserFEproblem()</span></code></a>.
The methods inside the class are defined by overriding the methods inside the parent class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_general_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set here all the parameters of the problem, except material properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genprops</span><span class="o">=</span><span class="n">General_FEproblem_properties</span><span class="p">()</span>
    <span class="c1"># Number of state variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genprops</span><span class="o">.</span><span class="n">p_nsvars</span><span class="o">=</span><span class="mi">110</span>
</pre></div>
</div>
<p>This method is used to provide the number of state variables of the material. In this tutorial the thermo- hydro- mechanical behavior is important
and therefore, the state of material is described by the increment of generalized stress, generalized total strain, generalized elastic strain, generalized plastic strain,
plastic strain multiplier and generalized plastic strain rate. The generalized variables include the mechanical stresses, Cosserat moment and total strains, curvatures
(elastic, plastic decomposition). Moreover, the state of the material takes into account the rate of plastic strains/curvatures and the fluxes and partial derivatives of the pressure and temperature fields.
For a 1D problem 6 generalized strain components (and consequently  6 generalized stress components) are needed
for the description of equilibrium. The state of the material contains the information also for the rest of the generalized components of the multiphysics 3D problem.
For each material used by the Numerical Geolab, the number of state variable components is given in the corresponding <a class="reference internal" href="material_description_state_variables.html#material-description-of-state-variables"><span class="std std-ref">material table</span></a>.</p>
<p>Next we continue by generating the mesh for the problem at hand. Here, we model a 1D Cosserat linear segment.
For this simple geometry the capabilities of the <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.mesh.html#module-dolfin.cpp.mesh" title="(in DOLFIN)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dolfin.cpp.mesh</span></code></a> module can be used to define
a linear segment consisting of 1 line element by specifying the left and right b.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set mesh and subdomains</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mesh</span><span class="o">=</span><span class="n">IntervalMesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">MeshFunction</span><span class="p">(</span><span class="s2">&quot;size_t&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="p">()</span><span class="o">.</span><span class="n">dim</span><span class="p">())</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">MeshFunction</span><span class="p">(</span><span class="s2">&quot;size_t&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="p">()</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">cd</span><span class="p">,</span> <span class="n">fd</span>
</pre></div>
</div>
<p>For the domain at hand we specify a discretization with nw=1 element along the x[0] component. The <code class="xref py py-class docutils literal notranslate"><span class="pre">dolfin.cpp.mesh.MeshFunction</span></code> method of dolfin is used to
provide the mesh object, the interior domain and the boundary domains.</p>
<p>We next assign values to the regions of the mesh defined by different material properties.</p>
<div class="highlight-python notranslate" id="create-subdomains"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_subdomains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mesh</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create subdomains by marking regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subdomains</span> <span class="o">=</span> <span class="n">MeshFunction</span><span class="p">(</span><span class="s2">&quot;size_t&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="p">()</span><span class="o">.</span><span class="n">dim</span><span class="p">())</span>
    <span class="n">subdomains</span><span class="o">.</span><span class="n">set_all</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#assigns material/props number 0 everywhere</span>
    <span class="k">return</span> <span class="n">subdomains</span>
</pre></div>
</div>
<p>In this tutorial all the domain is defined by the same material properties and therefore the value 0 will be assigned everywhere inside the mesh.
This value is a number indicating which material parameters need to be taken into account in each mesh region (see the corresponding method <a href="#id6"><span class="problematic" id="id7">`set_material_params()`_</span></a>).</p>
<div class="admonition-important-note admonition">
<p class="admonition-title">IMPORTANT NOTE</p>
<p>We need also to initialize the Gauss point monitoring subdomain, when state variable output is needed. We use the same method as in the case of material definition based onthe FEniCs software:</p>
</div>
<section id="monitoring-stress-and-state-variables-at-the-gauss-points">
<h3><span class="section-number">6.3.1. </span>Monitoring stress and state variables at the Gauss points<a class="headerlink" href="#monitoring-stress-and-state-variables-at-the-gauss-points" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Gauss_point_Querry</span><span class="p">(</span><span class="n">SubDomain</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">nw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">=</span><span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="o">=</span><span class="n">nw</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">on_boundary</span><span class="p">):</span>
        <span class="n">rreg</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">))</span>
        <span class="n">lreg</span><span class="o">=-</span><span class="mf">1.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rreg</span><span class="p">,</span><span class="n">lreg</span><span class="p">)</span>
        <span class="c1"># return x[0] &gt;= 1./2.-1./80. and between(x[1], (-0.1,0.1))</span>
        <span class="k">return</span> <span class="n">between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">lreg</span><span class="p">,</span><span class="n">rreg</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_Gauss_point_querry_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mesh</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create subdomains by marking regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">GaussDomain</span> <span class="o">=</span> <span class="n">MeshFunction</span><span class="p">(</span><span class="s2">&quot;size_t&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">topology</span><span class="p">()</span><span class="o">.</span><span class="n">dim</span><span class="p">())</span>
    <span class="n">GaussDomain</span><span class="o">.</span><span class="n">set_all</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#assigns material/props number 0 everywhere</span>
    <span class="n">GaussDomainQuerry</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gauss_point_Querry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">)</span>
    <span class="n">GaussDomainQuerry</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">GaussDomain</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GaussDomain</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">We note here that this mark has nothing to do with marking of the materials or the boundaries, because it will be applied internally, to different instances of the <code class="xref py py-class docutils literal notranslate"><span class="pre">VectorFunctionSpace()</span></code> class of the FEniCs software.</div>
</div>
<p>We note here that the Gauss point definition is done on the cells of the Finite Element mesh and not on the boundary facets. This is done because the Gauss points are on the
interior of the domain and use of the nodal selection algorithm inside the Numerical Geolab module <a class="reference internal" href="ngeoFE.html#module-ngeoFE.feproblem" title="ngeoFE.feproblem"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ngeoFE.feproblem</span></code></a> (see method <a class="reference internal" href="ngeoFE.html#ngeoFE.feproblem.UserFEobject.set_history_output_indices" title="ngeoFE.feproblem.UserFEobject.set_history_output_indices"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ngeoFE.feproblem.UserFEobject.set_history_output_indices()</span></code></a>)
returns an empty set. The method <a class="reference internal" href="ngeoFE.html#ngeoFE.feproblem.UserFEobject.set_svars_history_output_indices" title="ngeoFE.feproblem.UserFEobject.set_svars_history_output_indices"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_svars_history_output_indices</span></code></a> needs to be called -internally- instead.</p>
</section>
<section id="boundary-identification">
<h3><span class="section-number">6.3.2. </span>Boundary identification<a class="headerlink" href="#boundary-identification" title="Permalink to this heading">¶</a></h3>
<p>We proceed now by identifying the boundaries needed for the application of the boundary conditions at a later stage of the modeling procedure.
We make use of the <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.mesh.html#dolfin.cpp.mesh.SubDomain" title="(in DOLFIN)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dolfin.cpp.mesh.SubDomain</span></code></a> parent class inside dolfin:</p>
<dl class="py class">
<dt class="sig sig-object py" id="dolfin.cpp.mesh.SuDomain">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dolfin.cpp.mesh.</span></span><span class="sig-name descname"><span class="pre">SuDomain</span></span><a class="headerlink" href="#dolfin.cpp.mesh.SuDomain" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>We create a child class that will handle the assignment of different labels at the different faces of the unit cube. We implement this by
modifying the <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.mesh.html#dolfin.cpp.mesh.SubDomain.inside" title="(in DOLFIN)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">inside()</span></code></a> method of the <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.mesh.html#dolfin.cpp.mesh.SubDomain" title="(in DOLFIN)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubDomain</span></code></a> parent class.</p>
<dl class="py method">
<dt class="sig sig-object py" id="dolfin.cpp.mesh.SuDomain.inside">
<span class="sig-prename descclassname"><span class="pre">dolfin.cpp.mesh.SuDomain.</span></span><span class="sig-name descname"><span class="pre">inside</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#dolfin.cpp.mesh.SuDomain.inside" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Boundary</span><span class="p">(</span><span class="n">SubDomain</span><span class="p">):</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xyz</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="o">=</span><span class="n">xyz</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">=</span><span class="n">param</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
   <span class="k">def</span> <span class="nf">inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">on_boundary</span><span class="p">):</span>
      <span class="n">tol</span> <span class="o">=</span> <span class="n">DOLFIN_EPS</span>
      <span class="k">return</span> <span class="n">on_boundary</span> <span class="ow">and</span> <span class="n">near</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
<p>Inside the <code class="xref py py-class docutils literal notranslate"><span class="pre">Boundary</span> <span class="pre">subclass</span></code> we define the logical test for assigning the specific boundary node in one of the boundary regions, where the boundary conditions will be applied.
The value x[i] indicates the spatial coordinate <img class="math" src="_images/math/b6e6cb367cb63f0c95f6695d9991e4f07f693e82.png" alt="x_i"/> of the problem at hand. We continue by marking the boundaries of the model based on the classes defined during the boundary identification phase (see section <a class="reference internal" href="#boundary-identification"><span class="std std-ref">Boundary identification</span></a> above).
We do so by assigning the numbers 1 to 6 to the different boundary facets of the model. To do this we use the method <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.mesh.html#dolfin.cpp.mesh.SubDomain.mark" title="(in DOLFIN)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mark()</span></code></a> from the <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.mesh.html#dolfin.cpp.mesh.SubDomain" title="(in DOLFIN)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SubDomain</span></code></a> class of
<a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/">dolfin</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mark_boundaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mark left and right boundary points</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Boundary</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">left0</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">boundaries</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">right0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Boundary</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">right0</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">boundaries</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<section id="initial-conditions">
<h4><span class="section-number">6.3.2.1. </span>Initial conditions<a class="headerlink" href="#initial-conditions" title="Permalink to this heading">¶</a></h4>
<p>Our test takes place in a fluid saturated geomaterial, which lies under total compression <code class="xref py py-const docutils literal notranslate"><span class="pre">Normal_loading</span> <span class="pre">total</span></code> = <img class="math" src="_images/math/6852e1d7c887036256359de6977aa964f4734ce3.png" alt="-200 \text{MPa}"/>.
The pore fluid pressure is set to be <code class="xref py py-const docutils literal notranslate"><span class="pre">self.Pressure_loading</span></code> = <img class="math" src="_images/math/5616a67c943ae8d8f2d441f9c1b5e842cea34348.png" alt="66 \text{MPa}"/>, thus initially the material lies under uniform effective
compressive stress <code class="xref py py-const docutils literal notranslate"><span class="pre">self.Normal_loading_eff</span></code> = <img class="math" src="_images/math/6949944dcd2749dba1789cd7af714b091b8f569c.png" alt="-133.33 \text{MPa}"/> according to the Terzaghi principle. We need to specify the initial state at the start of the analysis,
by making use of the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">set_initial_conditions()</span></code> :</p>
<div class="highlight-python notranslate" id="id1"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_initial_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize state variables vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#Modify the state variables (corresponding to the stresses)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genprops</span><span class="o">.</span><span class="n">p_nsvars</span><span class="p">)</span>
    <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_eff</span>
    <span class="n">tmp</span><span class="p">[</span><span class="mi">5</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_eff</span>
    <span class="n">tmp</span><span class="p">[</span><span class="mi">9</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_eff</span>
    <span class="n">tmp</span><span class="p">[</span><span class="mi">101</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pressure_loading</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">svars2</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">Constant</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>

    <span class="c1">#Modify the stresses (for Paraview)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_total</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">sigma2</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">Constant</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>

    <span class="n">tmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">tmp</span><span class="p">[</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pressure_loading</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">usol</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">Constant</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>

    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="assigning-boundary-conditions">
<h4><span class="section-number">6.3.2.2. </span>Assigning boundary conditions<a class="headerlink" href="#assigning-boundary-conditions" title="Permalink to this heading">¶</a></h4>
<p>We are now able to identify the boundaries of the mesh and assign different boundary condition to each side of the boundary.
The way we apply the boundary conditions can be seen in the method
<code class="xref py py-meth docutils literal notranslate"><span class="pre">set_bcs()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_bcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set boundary conditions for the user problem / could be replaced by external mesher, e.g. Abaqus, Gmsh...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scale_u</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_eff</span>
    <span class="n">tanfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">u1_tot</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">tanfi</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">h2</span><span class="p">))</span><span class="o">*</span><span class="mf">1.2</span><span class="o">*</span><span class="p">(</span><span class="n">G</span><span class="o">+</span><span class="n">Gc</span><span class="p">))</span>

    <span class="n">bcs</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bcs</span> <span class="o">=</span> <span class="p">[</span>

            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>

            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_total</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_u</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_step</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">bcs</span> <span class="o">=</span> <span class="p">[</span>

            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>

            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_total</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_u</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1_tot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_u</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>

            <span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem_step</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">bcs</span> <span class="o">=</span> <span class="p">[</span>

            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>

            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_loading_total</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_u</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1_tot</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_u</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]],</span>
            <span class="p">]</span>
    <span class="k">return</span> <span class="n">bcs</span>
</pre></div>
</div>
<p>Inside this method the boundaries are assigned with the use of a nested list. Dirichlet, Neuman and Robin boundary conditions can be applied
both incrementaly and instantaneously. The boundary conditions can be assigned to a boundary region or pointwise.</p>
<div class="line-block">
<div class="line">The nested list contains the following information:</div>
</div>
<div class="line-block">
<div class="line">[region id, [type of bc, vector component ,value]]</div>
</div>
<p>In this example, the region id ranges from 1 to 2 indicating the left and right regions of the boundary respectively.
On the left of the model the displacement components of the vectorspace ([0,0],[0,1]), the type of bc is set to 0, with zero value indicating Dirichlet boundary conditions.
On the right of the model for the normal displacement component of the vectorspace ([0,0]), the type of bc is set to 3, indicating Neumann boundary conditions with value equal to the total normal stress <code class="xref py py-const docutils literal notranslate"><span class="pre">self.Normal_loading_total</span></code>,
specifying a instantaneous Neuman boundary condition that equilibrates the applied pre-stress inside the material.</p>
<p>For the rotation components of the vectorspace ([1]), the type of bc is set to 1, with value 0, indicating that
during the shearing of the  layer, no Cosserat moment is applied on both bounds of the linear domain.</p>
<p>For the pore fluid pressure and temperature components of the vectorspace ([2,0], [2,1]) we set the type of boundary condition to 1, with value 0, indicating that
during the triaxial analysis, we apply undrained, adiabatic Neumann conditions.</p>
<p>In the next steps, we implement an adiabatic undrained shear test. We set the horizontal displacement component [0,1] of the right boundary (region_id=2) to a final value <code class="xref py py-const docutils literal notranslate"><span class="pre">self.u1_tot</span></code>,
under constant Neumann total stress.</p>
</section>
</section>
<section id="history-output-specification">
<h3><span class="section-number">6.3.3. </span>History output specification<a class="headerlink" href="#history-output-specification" title="Permalink to this heading">¶</a></h3>
<p>Numerical Geolab offers the user the capability of extracting the output at the converged increments of the numerical analysis at specific Gauss points
and nodes of the numerical model. This capability is given to the user in order to obtain the exact nodal output of the solution (forces, displacements)
and the corresponding state variables output at the Gauss points, instead of using the interpolated results provided in a separate .vtk file
for postprocessing with a third party software (e.g. Paraview).</p>
<section id="assigning-the-nodal-history-output">
<h4><span class="section-number">6.3.3.1. </span>Assigning the nodal history output<a class="headerlink" href="#assigning-the-nodal-history-output" title="Permalink to this heading">¶</a></h4>
<p>The history output at the nodes can be given by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">history_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to get output of residual at selected node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hist</span><span class="o">=</span><span class="p">[[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">1</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]]],</span>
          <span class="p">[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">0</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]]],</span>
          <span class="p">]</span>
    <span class="k">return</span> <span class="n">hist</span>
</pre></div>
</div>
<p>The node specification works the same way as in set_bcs(). In this example we choose the right part of the boundary (2) in order to monitor the
all the vector components ([0,0],[0,1],[1],[2,0],[2,1]) of the force (1) and displacements (0) fields.</p>
</section>
<section id="assigning-the-state-variable-history-output-at-the-gauss-points">
<h4><span class="section-number">6.3.3.2. </span>Assigning the state variable history output at the Gauss points<a class="headerlink" href="#assigning-the-state-variable-history-output-at-the-gauss-points" title="Permalink to this heading">¶</a></h4>
<p>We assign next the components of the state variables that need to be monitored at the specific Gauss points:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">history_svars_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to get output of svars at selected Gauss point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hist_svars</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">0</span><span class="p">]]],</span> <span class="c1">#tau_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">]]],</span> <span class="c1">#tau_12</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">2</span><span class="p">]]],</span> <span class="c1">#tau_13</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">3</span><span class="p">]]],</span> <span class="c1">#tau_21</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">4</span><span class="p">]]],</span> <span class="c1">#tau_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">5</span><span class="p">]]],</span> <span class="c1">#tau_23</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">6</span><span class="p">]]],</span> <span class="c1">#tau_31</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">7</span><span class="p">]]],</span> <span class="c1">#tau_32</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">8</span><span class="p">]]],</span> <span class="c1">#tau_33</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">9</span><span class="p">]]],</span>  <span class="c1">#mu_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">10</span><span class="p">]]],</span> <span class="c1">#mu_12</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">11</span><span class="p">]]],</span> <span class="c1">#mu_13</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">12</span><span class="p">]]],</span> <span class="c1">#mu_21</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">13</span><span class="p">]]],</span> <span class="c1">#mu_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">14</span><span class="p">]]],</span> <span class="c1">#mu_23</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">15</span><span class="p">]]],</span> <span class="c1">#mu_31</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">16</span><span class="p">]]],</span> <span class="c1">#mu_32</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">17</span><span class="p">]]],</span> <span class="c1">#mu_33</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">18</span><span class="p">]]],</span> <span class="c1">#qhy_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">19</span><span class="p">]]],</span> <span class="c1">#qhy_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">20</span><span class="p">]]],</span> <span class="c1">#qhy_33</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">21</span><span class="p">]]],</span> <span class="c1">#qth_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">22</span><span class="p">]]],</span> <span class="c1">#qth_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">23</span><span class="p">]]],</span> <span class="c1">#qth_33</span>


                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">24</span><span class="p">]]],</span> <span class="c1">#gamma_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">25</span><span class="p">]]],</span> <span class="c1">#gamma_12</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">26</span><span class="p">]]],</span> <span class="c1">#gamma_13</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">27</span><span class="p">]]],</span> <span class="c1">#gamma_21</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">28</span><span class="p">]]],</span> <span class="c1">#gamma_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">29</span><span class="p">]]],</span> <span class="c1">#gamma_23</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">30</span><span class="p">]]],</span> <span class="c1">#gamma_31</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">31</span><span class="p">]]],</span> <span class="c1">#gamma_32</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">32</span><span class="p">]]],</span> <span class="c1">#gamma_33</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">33</span><span class="p">]]],</span> <span class="c1">#kappa_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">34</span><span class="p">]]],</span> <span class="c1">#kappa_12</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">35</span><span class="p">]]],</span> <span class="c1">#kappa_13</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">36</span><span class="p">]]],</span> <span class="c1">#kappa_21</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">37</span><span class="p">]]],</span> <span class="c1">#kappa_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">38</span><span class="p">]]],</span> <span class="c1">#kappa_23</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">39</span><span class="p">]]],</span> <span class="c1">#kappa_31</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">40</span><span class="p">]]],</span> <span class="c1">#kappa_32</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">41</span><span class="p">]]],</span> <span class="c1">#kappa_33</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">42</span><span class="p">]]],</span> <span class="c1">#P,_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">43</span><span class="p">]]],</span> <span class="c1">#P,_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">44</span><span class="p">]]],</span> <span class="c1">#P,_33</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">45</span><span class="p">]]],</span> <span class="c1">#T,_11</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">46</span><span class="p">]]],</span> <span class="c1">#T,_22</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">47</span><span class="p">]]],</span> <span class="c1">#T,_33</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">76</span><span class="p">]]],</span> <span class="c1">#d_γ11_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">77</span><span class="p">]]],</span> <span class="c1">#d_γ12_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">78</span><span class="p">]]],</span> <span class="c1">#d_γ13_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">79</span><span class="p">]]],</span> <span class="c1">#d_γ21_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">80</span><span class="p">]]],</span> <span class="c1">#d_γ22_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">81</span><span class="p">]]],</span> <span class="c1">#d_γ23_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">82</span><span class="p">]]],</span> <span class="c1">#d_γ31_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">83</span><span class="p">]]],</span> <span class="c1">#d_γ32_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">84</span><span class="p">]]],</span> <span class="c1">#d_γ33_p</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">85</span><span class="p">]]],</span> <span class="c1">#d_k11_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">86</span><span class="p">]]],</span> <span class="c1">#d_k12_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">87</span><span class="p">]]],</span> <span class="c1">#d_k13_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">88</span><span class="p">]]],</span> <span class="c1">#d_k21_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">89</span><span class="p">]]],</span> <span class="c1">#d_k22_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">90</span><span class="p">]]],</span> <span class="c1">#d_k23_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">91</span><span class="p">]]],</span> <span class="c1">#d_k31_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">92</span><span class="p">]]],</span> <span class="c1">#d_k32_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">93</span><span class="p">]]],</span> <span class="c1">#d_k33_p</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">49</span><span class="p">]]],</span> <span class="c1">#γ11_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">53</span><span class="p">]]],</span> <span class="c1">#γ22_p</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">57</span><span class="p">]]],</span> <span class="c1">#γ33_p</span>

                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">75</span><span class="p">]]],</span> <span class="c1">#lambda_dot</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">108</span><span class="p">]]],</span> <span class="c1">#DP</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span><span class="p">,[</span><span class="mi">109</span><span class="p">]]],</span> <span class="c1">#DT</span>
                <span class="p">]</span>
    <span class="k">return</span> <span class="n">hist_svars</span>
</pre></div>
</div>
<p>The Gauss point specification works the same way as in set_bcs() and history_output(). In this example in the region (1) defined by the
method <code class="xref py py-meth docutils literal notranslate"><span class="pre">create_Gauss_point_querry_domain</span></code>
, we choose to monitor the above vector components, which translate to the stresses, increments of plastic strain pressure, temperature and normal total strains respectively.
The mapping between the vector components of the <a class="reference external" href="https://fenicsproject.org/olddocs/dolfin/2019.1.0/python/_autogenerated/dolfin.cpp.function.html#dolfin.cpp.function.FunctionSpace" title="(in DOLFIN)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span> <span class="pre">space</span></code></a> and the state variable components is given in the corresponding <a class="reference internal" href="material_description_state_variables.html#material-description-of-state-variables"><span class="std std-ref">material table</span></a>.</p>
</section>
</section>
<section id="material-specification">
<h3><span class="section-number">6.3.4. </span>Material specification<a class="headerlink" href="#material-specification" title="Permalink to this heading">¶</a></h3>
<p>Next, we define the analysis material that we have already assigned in the <a class="reference internal" href="#create-subdomains">create_subdomains()</a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_materials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create material objects and set material parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mats</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1"># load material #1</span>

    <span class="n">env_lib</span><span class="o">=</span><span class="n">ngeo_parameters</span><span class="o">.</span><span class="n">env_lib</span>
    <span class="n">umat_lib_path</span><span class="o">=</span> <span class="n">ngeo_parameters</span><span class="o">.</span><span class="n">umat_lib_path</span>
    <span class="n">umat_lib</span> <span class="o">=</span> <span class="n">umat_lib_path</span><span class="o">+</span><span class="s1">&#39;/COSSERAT3D-THM/libplast_Cosserat3D-THM.so&#39;</span>
    <span class="n">umat_id</span><span class="o">=</span><span class="mi">1</span>      <span class="c1"># if many materials exist in the same library</span>
    <span class="n">mat</span><span class="o">=</span><span class="n">UserMaterial</span><span class="p">(</span><span class="n">env_lib</span><span class="p">,</span><span class="n">umat_lib</span><span class="p">,</span><span class="n">umat_id</span><span class="p">)</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_material_1_properties</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="n">mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mats</span>
</pre></div>
</div>
<p>The ngeo_parameters.py module contains the relative path to the materials libraries, which specify the different materials available to the user.
The variable umat_id=1 needs to be set for the 1D analyses performed here. It specifies the mapping of the updated vector components of the
strain increment <img class="math" src="_images/math/192b3379a023c668cef3f79f283f090b82410ba4.png" alt="(\gamma_{11},\gamma_{12},\kappa_{31},q^{hy}_{11},q^{th}_{11})"/>
and the corresponding tensor components of the constitutive matrix, with their position in the 3D generalized Voigt strain vector
and 3D constitutive matrix provided at the material subroutine (material algorithm). This mapping returns back
the correct components of the stress vector and constitutive matrix to pass into the residual calculation of the
weak form in dolfin (equilibrium iterations). The material properties passed into the material algorithm, are set
with the helper method
<code class="xref py py-meth docutils literal notranslate"><span class="pre">set_material_params()</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_material_1_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets material parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">g1</span><span class="o">=</span><span class="mf">8.</span><span class="o">/</span><span class="mf">5.</span><span class="p">;</span><span class="n">g2</span><span class="o">=</span><span class="mf">2.</span><span class="o">/</span><span class="mf">5.</span><span class="p">;</span><span class="n">g3</span><span class="o">=</span><span class="mf">8.</span><span class="o">/</span><span class="mf">5.</span><span class="p">;</span><span class="n">g4</span><span class="o">=</span><span class="mf">2.</span><span class="o">/</span><span class="mf">5.</span>

    <span class="n">h1</span><span class="o">=</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span> <span class="p">;</span><span class="n">h2</span><span class="o">=-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span><span class="n">h3</span><span class="o">=</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">;</span><span class="n">h4</span><span class="o">=-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span>

    <span class="n">K</span><span class="o">=</span><span class="mf">666.66</span><span class="p">;</span> <span class="n">G</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="mf">3.</span><span class="p">;</span> <span class="n">Gc</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="mf">3.</span> <span class="p">;</span> <span class="n">L</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mf">2.</span><span class="p">);</span><span class="n">R</span><span class="o">=</span><span class="mf">10.</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">);</span>
    <span class="n">MG</span><span class="o">=</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">h3</span> <span class="p">;</span> <span class="n">MGc</span><span class="o">=</span><span class="n">MG</span><span class="p">;</span> <span class="c1">#th_g=0.;</span>

    <span class="n">permeability1</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="mf">8.</span><span class="p">;</span><span class="n">fluid_viscocity</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span><span class="n">bstar</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="mf">8.</span><span class="p">;</span>
    <span class="n">permeability</span> <span class="o">=</span> <span class="n">permeability1</span><span class="o">/</span><span class="n">bstar</span>
    <span class="n">conductivity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">rhoC</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">alpha</span> <span class="o">=</span><span class="mf">0.</span><span class="p">;</span> <span class="n">lstar</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="mf">10.</span><span class="o">**</span><span class="mf">8.</span><span class="p">;</span>

    <span class="n">tanfi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">cc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span>
    <span class="n">tanpsi</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span> <span class="n">Hsfi</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span> <span class="n">Hscc</span><span class="o">=</span><span class="mf">0.</span><span class="p">;</span>
    <span class="n">eta1</span><span class="o">=</span><span class="mf">0.0</span>

    <span class="n">eta1</span><span class="o">=</span><span class="mf">0.</span>

    <span class="n">prop_num</span><span class="o">=</span><span class="mi">29</span>
    <span class="n">props</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">prop_num</span><span class="p">)</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">K</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">G</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">Gc</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">L</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">MG</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="n">MGc</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="n">R</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span><span class="n">permeability</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="n">fluid_viscocity</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">=</span><span class="n">bstar</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">=</span><span class="n">conductivity</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">=</span><span class="n">rhoC</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">=</span><span class="n">alpha</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">=</span><span class="n">lstar</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">=</span><span class="n">tanfi</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="n">cc</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">=</span><span class="n">tanpsi</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">=</span><span class="n">Hsfi</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">=</span><span class="n">Hscc</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">=</span><span class="n">h1</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span><span class="o">=</span><span class="n">h2</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span><span class="o">=</span><span class="n">h3</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span><span class="o">=</span><span class="n">h4</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span><span class="o">=</span><span class="n">g1</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span><span class="o">=</span><span class="n">g2</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span><span class="o">=</span><span class="n">g3</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span><span class="o">=</span><span class="n">g4</span>
    <span class="n">props</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="o">=</span><span class="n">eta1</span>

    <span class="k">return</span> <span class="n">props</span>
</pre></div>
</div>
<p>The material used in this application is an elastic perfectly plastic that follows the Drucker-Prager yield criterion <img class="math" src="_images/math/0176df9cf54c2f853e26d5f5a3fed1173ee73f39.png" alt="\phi=0.5"/>
with non-associative flow rule <img class="math" src="_images/math/addfaf5c1760ea7887b46bff30deb456050b235e.png" alt="\psi=0"/>. We specify the material’s elastic parameters using the material young modulus <img class="math" src="_images/math/baa39b18df16a92d8759ff92448d40af5a942f3c.png" alt="EE=2000\;\text{MPa}"/> and
Poisson ratio <img class="math" src="_images/math/7522733ec12a6c981a6749ec4b96a9d5283ed414.png" alt="\nu=0"/>. The parameters passed into the material subroutine are the 3D isotropic compression modulus <code class="xref py py-const docutils literal notranslate"><span class="pre">KK</span></code> and the shear modulus
<code class="xref py py-const docutils literal notranslate"><span class="pre">GG</span></code>. Therefore, a transformation of the elastic constants is needed. The material constants ( <code class="xref py py-const docutils literal notranslate"><span class="pre">GG</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">KK</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">chi</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">eta_f</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">lstar</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">bstar</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">alpha</span></code>,
<code class="xref py py-const docutils literal notranslate"><span class="pre">kT</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">rhoC</span></code> ), and their position in the material properties (numpy array <code class="xref py py-const docutils literal notranslate"><span class="pre">props</span></code>), can be found in the
<a class="reference internal" href="material_description_state_variables.html#material-description-of-state-variables"><span class="std std-ref">Material description</span></a> and the material library files that accompany Numerical Geolab.</p>
<p>We intent to verify that our analysis indeed predicts the correct relations between the yielding limit and the effective material pressure.
To do so we will set the cohesion of the material to <img class="math" src="_images/math/08854d61ea1e5d96f0534d6ed5cde425ac8a8771.png" alt="c=0\;\text{MPa}"/>, so that the material yield strength depends only on the confinement
excerted by the compressive material pressure. We will set the specific heat <img class="math" src="_images/math/e97b4d1b093d2644ff63100492952c65ef5eb8d4.png" alt="\rho C=1\frac{^\text{o}\text{C}}{\text{J}}"/> to account for the temperature increase due to yielding.
We will set the thermal pressurization constant <img class="math" src="_images/math/0f0a6d5e8bb8a90fdc253784d84b7d49e352ae06.png" alt="\Lambda=\frac{\lambda^\star}{\beta^\star}=1\;\frac{^0\text{C}}{\text{MPa}}"/> in order to account for the coupling between the
pore fluid pressure and temperature equations. We set the themal expansion coefficient <img class="math" src="_images/math/4cacbe4acfc65c087e1a44ab83568e5bb7902ba8.png" alt="\alpha=0\text{[}{^{\text{o}}\text{C}}^{-1}\text{]}"/> to deactivate the thermomechanical coupling.
This means that any change in the vertical displacement of our sample will come as a result of the swelling of the sample due to the reduction in measure of the compressive effective stress of the sample.</p>
<div class="line-block">
<div class="line">Once the analysis material(s) have been set we are able to exit the class definition for <a class="reference internal" href="#thm1d-feproblem"><span class="std std-ref">Finite element problem</span></a>.</div>
</div>
</section>
</section>
<section id="analysis-excecution-and-postprocessing">
<h2><span class="section-number">6.4. </span>Analysis excecution and postprocessing<a class="headerlink" href="#analysis-excecution-and-postprocessing" title="Permalink to this heading">¶</a></h2>
<p>Our model is now set and ready to run. In this application we will test the effect of the THM couplings in the post yielding
behavior of the material. We will create a model derived by the class <a class="reference internal" href="#thm1d-feproblem"><span class="std std-ref">Finite element problem</span></a>.
We will study the problem of a confined unit layer comprised of one linear element. This problem indicates that the diffusion terms of temperature and pressure are negligible
. The full problem description script can be found <code class="xref py py-mod docutils literal notranslate"><span class="pre">here</span></code>.
The results are presented in <a class="reference internal" href="#my-table"><span class="std std-ref">Figure 1</span></a>, <a class="reference internal" href="#my-table2"><span class="std std-ref">Figure 2</span></a>,:ref:<cite>Figure 3&lt;my_table3&gt;</cite>, <span class="xref std std-ref">Figure 4</span></p>
<section id="controling-the-analysis-time">
<h3><span class="section-number">6.4.1. </span>Controling the analysis time<a class="headerlink" href="#controling-the-analysis-time" title="Permalink to this heading">¶</a></h3>
<p>The following code block provides the solver parameters including the step total analysis time, the maximum time increment, the tolerance of the converged increment
and the maximum number of increments.</p>
<p>The parameter <code class="xref py py-const docutils literal notranslate"><span class="pre">scale_t</span></code> controls the overall time increment and total time of the analysis. We specify it as an attribute of the
class so that it can be called by the other analysis procedure method. To avoid confusion with the problem description we choose not to incorporate it as an
argument to be passed at the level of the problem definition. Next, the main part of the analysis follows.
This method specifies the boundary conditions to be applied at each step of the analysis and the total time of each analysis step.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="k">def</span> <span class="nf">run_analysis_procedure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reference_data_path</span><span class="p">):</span>
     <span class="n">saveto</span><span class="o">=</span><span class="n">reference_data_path</span><span class="o">+</span><span class="s2">&quot;/THERMO-HYDRO-PLASTIC/Cosserat_1D_Drucker-Prager_THM_test_step_0&quot;</span><span class="o">+</span><span class="s2">&quot;_App_1_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.xdmf&quot;</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">problem_step</span> <span class="o">=</span> <span class="mi">0</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">bcs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">()</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">symbolic_bcs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initial&quot;</span><span class="p">)</span>
<span class="hll">     <span class="n">converged</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">saveto</span><span class="p">,</span><span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>     <span class="n">scale_t_program</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_t</span><span class="p">]</span>
     <span class="n">ninc</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shearing1&quot;</span><span class="p">)</span>

     <span class="n">nsteps</span><span class="o">=</span><span class="mi">2</span>
     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">problem_step</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
         <span class="n">scale_t</span> <span class="o">=</span> <span class="n">scale_t_program</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="o">.</span><span class="n">nincmax</span><span class="o">=</span><span class="n">ninc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="c1">#1000000</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="o">.</span><span class="n">dtmax</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">scale_t</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="o">.</span><span class="n">dt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="o">.</span><span class="n">dtmax</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="o">.</span><span class="n">tmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="o">.</span><span class="n">tmax</span><span class="o">+</span><span class="mf">1.</span><span class="o">*</span><span class="n">scale_t</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">symbolic_bcs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_bcs</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">initBCs</span><span class="p">()</span>
         <span class="n">saveto</span><span class="o">=</span> <span class="n">reference_data_path</span><span class="o">+</span><span class="s2">&quot;/THERMO-HYDRO-PLASTIC/Cosserat_1D_Drucker-Prager_THM_test_step_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_App_1_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nw</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.xdmf&quot;</span>
         <span class="n">converged</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">saveto</span><span class="p">,</span><span class="n">summary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

     <span class="k">return</span> <span class="n">converged</span>
</pre></div>
</div>
<p>In this application two analysis steps are run. The first step of the analysis is the initial step, where we apply the initial compressive state in one increment under constant total normal stress.
We apply then one increment of shear deformation, under constant total normal stress, to provoke yielding of the material and pore fluid pressure increase, due to thermal pressurization.</p>
</section>
<section id="postprocessing-the-results">
<h3><span class="section-number">6.4.2. </span>Postprocessing the results<a class="headerlink" href="#postprocessing-the-results" title="Permalink to this heading">¶</a></h3>
<p>The following functions will help with unpacking the nodal solution and the state variables output at the Gauss points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">history_unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">list1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list1</span><span class="p">):</span>
        <span class="c1"># print(elem)</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array_time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array_gen_force</span><span class="o">=</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array_gen_disp</span><span class="o">=</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
            <span class="k">continue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">array_time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">array_time</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array_gen_force</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">array_gen_force</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array_gen_disp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">array_gen_disp</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">])))))</span>


<span class="k">def</span> <span class="nf">svars_history_unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">list1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(elem)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array_dtime</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">array_gp_svars_comp</span><span class="o">=</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="k">continue</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">array_dtime</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">array_dtime</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array_gp_svars_comp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">array_gp_svars_comp</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])))))</span>
</pre></div>
</div>
<p>The following functions allow us to extract the generalized force displacement vectors and the state variables at the Gauss points
into postprocessing atributes to be used by the user’s postprocessing algorithms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_generalized_force_disp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">analysis_history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">problem_history</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history_unpack</span><span class="p">(</span><span class="n">analysis_history</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">array_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">array_time</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">array_gen_force</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">array_gen_force</span><span class="p">[:,:]</span><span class="c1">#.reshape((-1,20))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">array_gen_disp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">array_gen_disp</span><span class="p">[:,:]</span><span class="c1">#.reshape((-1,20)).copy()</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">extract_svars_gauss_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">analysis_svars_history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feobj</span><span class="o">.</span><span class="n">problem_svars_history</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">svars_history_unpack</span><span class="p">(</span><span class="n">analysis_svars_history</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">array_dtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">array_dtime</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">array_gp_svars_comp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">array_gp_svars_comp</span><span class="p">[:,:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="excecuting-the-analysis">
<h3><span class="section-number">6.4.3. </span>Excecuting the analysis<a class="headerlink" href="#excecuting-the-analysis" title="Permalink to this heading">¶</a></h3>
<p>The following set of commands initializes the finite element formulation, the finite element problem
and runs the analysis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_FEformulation</span><span class="o">=</span><span class="n">CosseratTHM1DFEformulation</span><span class="p">()</span>
<span class="n">my_FEproblem1</span><span class="o">=</span><span class="n">CosseratTHM1DFEproblem</span><span class="p">(</span><span class="n">my_FEformulation</span><span class="p">)</span>
<span class="n">my_FEproblem1</span><span class="o">.</span><span class="n">give_me_solver_params</span><span class="p">(</span><span class="n">scale_t</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">converged1</span><span class="o">=</span><span class="n">my_FEproblem1</span><span class="o">.</span><span class="n">run_analysis_procedure</span><span class="p">(</span><span class="n">reference_data_path</span>
</pre></div>
</div>
</section>
<section id="plotting-the-analysis-values">
<h3><span class="section-number">6.4.4. </span>Plotting the analysis values<a class="headerlink" href="#plotting-the-analysis-values" title="Permalink to this heading">¶</a></h3>
<p>We will take advantage of the plotting capabilities of Numerical Geolab available in <a class="reference internal" href="ngeoFE_unittests.html#module-ngeoFE_unittests.plotting_params" title="ngeoFE_unittests.plotting_params"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ngeoFE_unittests.plotting_params</span></code></a>.
We will plot the deviatoric stress <img class="math" src="_images/math/061374b8a7f3f5e261ba34aead14b053fa1a5e90.png" alt="\sqrt{J_2}"/> [MPa] and the effective material pressure <img class="math" src="_images/math/e66553477b42e8c60d9fcfc13e7f89db43813c0d.png" alt="p^\prime"/> [MPa] in order to check the effect of the swelling in confinement w.r.t. time in Figure <a class="reference internal" href="#my-table"><span class="std std-ref">Figure 1</span></a>.
We can plot the vertical displacement <img class="math" src="_images/math/1cb8dc2233ece0c8dbd6bec0a11fceb0f7d24e7e.png" alt="u_z"/> [mm], w.r.t. time in Figure in <a class="reference internal" href="#my-table"><span class="std std-ref">Figure 1</span></a>, showing the swelling of the specimen.</p>
<table class="docutils align-default" id="my-table">
<tbody>
<tr class="row-odd"><td><figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/Cosserat_1D_Thermo_Hydro_plasticity_simple_shear_J_2_P_eff.svg"><img alt="alternate text" height="200px" src="_images/Cosserat_1D_Thermo_Hydro_plasticity_simple_shear_J_2_P_eff.svg" width="400px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.4.1 </span><span class="caption-text">The second invariant <img class="math" src="_images/math/061374b8a7f3f5e261ba34aead14b053fa1a5e90.png" alt="\sqrt{J_2}"/>
w.r.t. effective pore fluid pressure <img class="math" src="_images/math/e66553477b42e8c60d9fcfc13e7f89db43813c0d.png" alt="p^\prime"/>.
Due to the specimen’s confinement, it’s compression, leads to higher values of compressive material stresses, and thus
the specimen presents a softening response.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-center" id="id3">
<a class="reference internal image-reference" href="_images/Cosserat_1D_Thermo_Hydro_plasticity__simple_shear_u.svg"><img alt="alternate text" height="200px" src="_images/Cosserat_1D_Thermo_Hydro_plasticity__simple_shear_u.svg" width="400px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.4.2 </span><span class="caption-text">Vrtiscal displacement <img class="math" src="_images/math/1cb8dc2233ece0c8dbd6bec0a11fceb0f7d24e7e.png" alt="u_z"/> [mm] with respect to time, the model swells.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</td>
</tr>
</tbody>
</table>
<p>We next plot the values of Temperature <img class="math" src="_images/math/cd6adf04c8c281ba5a640fecb628609870088d0d.png" alt="T\;\left[^o\text{C}\right]"/> and pore fluid pressure <img class="math" src="_images/math/41c5440cac368da4510729836b512bbd620b029d.png" alt="P"/> [MPa]
w.r.t. to time, in the left part of <a class="reference internal" href="#my-table2"><span class="std std-ref">Figure 2</span></a>. In the right part of Figure <a class="reference internal" href="#my-table2"><span class="std std-ref">Figure 2</span></a>
we plot the values of pressure <img class="math" src="_images/math/cd1f2a41298013e8d557a206517abdd3c574027b.png" alt="\Delta P"/> and temperature <img class="math" src="_images/math/f5355f0309726d2d6385b3f4b300fec2072fe0bd.png" alt="\Delta T"/> increment w.r.t. time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values_time1</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">y1</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values_gen_disp1</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">x1</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y1</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">x2</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values_time1</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">y2</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values_gen_disp1</span><span class="p">[:,</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="n">x2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">my_FEproblem1</span><span class="o">.</span><span class="n">Pressure_loading</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">color1</span><span class="p">,</span> <span class="n">color2</span> <span class="o">=</span> <span class="n">plotting_params</span><span class="o">.</span><span class="n">object_plot_axes</span><span class="p">(</span><span class="s1">&#39;$t$ [s]&#39;</span><span class="p">,</span> <span class="n">y1_txt</span><span class="o">=</span><span class="s1">&#39;$T\; $[$^o$  C]&#39;</span><span class="p">,</span><span class="n">color1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">y2_txt</span><span class="o">=</span><span class="s1">&#39;$P$ [MPa]&#39;</span><span class="p">,</span><span class="n">color2</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>

<span class="n">plotting_params</span><span class="o">.</span><span class="n">object_plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">color1</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span><span class="n">color2</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span><span class="n">label_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plotting_params</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span>
<span class="n">plotting_params</span><span class="o">.</span><span class="n">plot_legends</span><span class="p">(</span><span class="n">ngeo_parameters</span><span class="o">.</span><span class="n">reference_data_path</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;Cauchy_3D_Triaxial_Thermo_Hydro_plasticity_T_P&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default" id="my-table2">
<tbody>
<tr class="row-odd"><td><figure class="align-center" id="id4">
<a class="reference internal image-reference" href="_images/Cosserat_1D_Thermo_Hydro_plasticity_simple_shear_T_P.svg"><img alt="alternate text" height="200px" src="_images/Cosserat_1D_Thermo_Hydro_plasticity_simple_shear_T_P.svg" width="400px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.4.3 </span><span class="caption-text">Temperature and Pressure diagrams (<img class="math" src="_images/math/3c6a5cddbc56308933f21468aa0e47018541f587.png" alt="T\;\left[^\text{o}\text{C}\right]"/>, <img class="math" src="_images/math/9cfdd00682c96d307fd18ab1e77492e383f21bfb.png" alt="\left[\text{MPa}\right]"/>, time <img class="math" src="_images/math/8ced87fef307753b57421193e1001a3cce9ffafd.png" alt="t\left[\text{s}\right]"/>)
The temperature and pressure show the same increase.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-center" id="id5">
<a class="reference internal image-reference" href="_images/Cosserat_1_Thermo_Hydro_plasticity_simple_shear_DT_DP.svg"><img alt="alternate text" height="200px" src="_images/Cosserat_1_Thermo_Hydro_plasticity_simple_shear_DT_DP.svg" width="400px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6.4.4 </span><span class="caption-text">Due to the choice of the material parameters we establish the the increase of temperature a
and pore fluid pressure are equal at each analysis increment.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">6. Cosserat THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion</a><ul>
<li><a class="reference internal" href="#begining-of-file">6.1. Begining of file</a></li>
<li><a class="reference internal" href="#finite-element-formulation">6.2. Finite element formulation</a></li>
<li><a class="reference internal" href="#finite-element-problem-description">6.3. Finite element problem description</a><ul>
<li><a class="reference internal" href="#monitoring-stress-and-state-variables-at-the-gauss-points">6.3.1. Monitoring stress and state variables at the Gauss points</a></li>
<li><a class="reference internal" href="#boundary-identification">6.3.2. Boundary identification</a><ul>
<li><a class="reference internal" href="#initial-conditions">6.3.2.1. Initial conditions</a></li>
<li><a class="reference internal" href="#assigning-boundary-conditions">6.3.2.2. Assigning boundary conditions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#history-output-specification">6.3.3. History output specification</a><ul>
<li><a class="reference internal" href="#assigning-the-nodal-history-output">6.3.3.1. Assigning the nodal history output</a></li>
<li><a class="reference internal" href="#assigning-the-state-variable-history-output-at-the-gauss-points">6.3.3.2. Assigning the state variable history output at the Gauss points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#material-specification">6.3.4. Material specification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#analysis-excecution-and-postprocessing">6.4. Analysis excecution and postprocessing</a><ul>
<li><a class="reference internal" href="#controling-the-analysis-time">6.4.1. Controling the analysis time</a></li>
<li><a class="reference internal" href="#postprocessing-the-results">6.4.2. Postprocessing the results</a></li>
<li><a class="reference internal" href="#excecuting-the-analysis">6.4.3. Excecuting the analysis</a></li>
<li><a class="reference internal" href="#plotting-the-analysis-values">6.4.4. Plotting the analysis values</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Tutorial%20Cauchy_THM_thermo_hydro_plasticity%20-%20Drucker-Prager%20yield%20criterion.html"
                          title="previous chapter"><span class="section-number">5.8. </span>Cauchy THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Tutorial_Cosserat_Breakage_Mechanics.html"
                          title="next chapter"><span class="section-number">7. </span>Simple shear of a 1D Cosserat layer with Breakage Mechanics material</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Tutorial_Cosserat_Breakage_Mechanics.html" title="7. Simple shear of a 1D Cosserat layer with Breakage Mechanics material"
             >next</a> |</li>
        <li class="right" >
          <a href="Tutorial%20Cauchy_THM_thermo_hydro_plasticity%20-%20Drucker-Prager%20yield%20criterion.html" title="5.8. Cauchy THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Numerical Geolab .1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">6. </span>Cosserat THM couplings: Thermo-hydro plasticity application - Drucker-Prager yield criterion</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Ioannis Stefanou.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.0.
    </div>
  </body>
</html>